workspace:
  path: /

pipeline:
  build:
    image: debian:latest
    commands: 
        - sed -i -e s/deb.debian.org/mirror.linux.pizza/g /etc/apt/sources.list
        - apt-get update
        - apt-get upgrade -y
        - apt-get install apache2 curl net-tools -y

  test:
    image: debian:latest
    commands:
        - sed -i -e s/deb.debian.org/mirror.linux.pizza/g /etc/apt/sources.list

  deploy:
    ssh:
    image: appleboy/drone-ssh
    host: web.linux.pizza
    username: root
    port: 22
    secrets: [ ssh_key ]
    script:
       - cd /home/web/
       - wget https://git.selea.se/jonathan/lp-landingpage/archive/master.zip
       - unzip master.zip
       - echo "done"

  notify:
    when:
      success: false
      failure: true
      change: true
    image: plugins/matrix
    settings:
    homeserver: https://matrix.selea.se
    roomid: YQaSpONowlLzEbWZNt:matrix.selea.se
    username:
      from_secret: matrix_username
    password:
      from_secret: matrix_password
